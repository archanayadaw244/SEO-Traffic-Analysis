
Create table SEO_Traffic ( Date Date,	Keyword nvarchar(100),	Page nvarchar(100),	Impressions	INT, 
Clicks int,	CTR	Float, Position Float);

INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-01-05','buy shoes','/home',320,45,14.06,5.32),
('2023-01-06','cheap laptops','/products',410,78,19.02,3.75),
('2023-01-07','digital marketing','/services/marketing',250,50,20.00,8.42),
('2023-01-08','seo services','/blog/seo',380,65,17.11,6.20),
('2023-01-09','best smartphones','/products/smartphones',460,120,26.09,2.95),
('2023-01-10','python tutorial','/blog/python',280,72,25.71,4.85),
('2023-01-11','learn sql','/blog/python',300,90,30.00,7.14),
('2023-01-12','fitness tips','/blog/fitness',270,54,20.00,9.32),
('2023-01-13','travel deals','/blog/travel',340,88,25.88,5.75),
('2023-01-14','web design','/services/design',390,99,25.38,3.98),
('2023-01-15','buy shoes','/home',250,30,12.00,10.50),
('2023-01-16','cheap laptops','/products',420,100,23.81,4.20),
('2023-01-17','digital marketing','/services/marketing',310,75,24.19,7.80),
('2023-01-18','seo services','/blog/seo',280,40,14.29,11.22),
('2023-01-19','best smartphones','/products/smartphones',500,140,28.00,2.50),
('2023-01-20','python tutorial','/blog/python',260,65,25.00,5.30),
('2023-01-21','learn sql','/blog/python',280,60,21.43,6.90),
('2023-01-22','fitness tips','/blog/fitness',300,66,22.00,8.00),
('2023-01-23','travel deals','/blog/travel',350,70,20.00,7.50),
('2023-01-24','web design','/services/design',370,95,25.68,3.70);


insert into SEO_Traffic( Date, Keyword, Page, Impressions, Clicks, CTR, Position) values('2023-01-25','buy shoes','/home',310,50,16.13,6.00),
('2023-01-26','cheap laptops','/products',400,85,21.25,4.50),
('2023-01-27','digital marketing','/services/marketing',270,60,22.22,8.80),
('2023-01-28','seo services','/blog/seo',360,72,20.00,7.20),
('2023-01-29','best smartphones','/products/smartphones',480,125,26.04,3.10),
('2023-01-30','python tutorial','/blog/python',290,70,24.14,5.00),
('2023-01-31','learn sql','/blog/python',310,80,25.81,6.50),
('2023-02-01','fitness tips','/blog/fitness',260,55,21.15,8.90),
('2023-02-02','travel deals','/blog/travel',330,75,22.73,5.80),
('2023-02-03','web design','/services/design',370,90,24.32,4.20),
('2023-02-04','buy shoes','/home',280,45,16.07,7.20),
('2023-02-05','cheap laptops','/products',390,95,24.36,4.00),
('2023-02-06','digital marketing','/services/marketing',300,70,23.33,7.50),
('2023-02-07','seo services','/blog/seo',340,60,17.65,9.00),
('2023-02-08','best smartphones','/products/smartphones',500,130,26.00,2.80),
('2023-02-09','python tutorial','/blog/python',270,68,25.19,5.50),
('2023-02-10','learn sql','/blog/python',290,75,25.86,6.80),
('2023-02-11','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-02-12','travel deals','/blog/travel',350,80,22.86,7.10),
('2023-02-13','web design','/services/design',360,85,23.61,4.00);


insert into SEO_Traffic(date, Keyword, Page, Impressions, Clicks, CTR, Position) values( '2023-02-14','buy shoes','/home',300,55,18.33,6.50),
('2023-02-15','cheap laptops','/products',410,90,21.95,4.80),
('2023-02-16','digital marketing','/services/marketing',280,60,21.43,8.20),
('2023-02-17','seo services','/blog/seo',370,75,20.27,7.50),
('2023-02-18','best smartphones','/products/smartphones',450,120,26.67,3.00),
('2023-02-19','python tutorial','/blog/python',260,65,25.00,5.20),
('2023-02-20','learn sql','/blog/python',280,72,25.71,6.90),
('2023-02-21','fitness tips','/blog/fitness',300,66,22.00,7.80),
('2023-02-22','travel deals','/blog/travel',340,78,22.94,5.70),
('2023-02-23','web design','/services/design',390,95,24.36,4.10),
('2023-02-24','buy shoes','/home',310,52,16.77,6.10),
('2023-02-25','cheap laptops','/products',420,98,23.33,4.20),
('2023-02-26','digital marketing','/services/marketing',310,70,22.58,7.60),
('2023-02-27','seo services','/blog/seo',280,55,19.64,8.90),
('2023-02-28','best smartphones','/products/smartphones',500,135,27.00,2.50),
('2023-03-01','python tutorial','/blog/python',270,68,25.19,5.30),
('2023-03-02','learn sql','/blog/python',290,75,25.86,6.70),
('2023-03-03','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-03-04','travel deals','/blog/travel',350,80,22.86,7.20),
('2023-03-05','web design','/services/design',360,85,23.61,4.00);


INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-03-06','buy shoes','/home',320,50,15.63,6.20),
('2023-03-07','cheap laptops','/products',400,85,21.25,4.50),
('2023-03-08','digital marketing','/services/marketing',270,60,22.22,8.80),
('2023-03-09','seo services','/blog/seo',360,72,20.00,7.20),
('2023-03-10','best smartphones','/products/smartphones',480,125,26.04,3.10),
('2023-03-11','python tutorial','/blog/python',290,70,24.14,5.00),
('2023-03-12','learn sql','/blog/python',310,80,25.81,6.50),
('2023-03-13','fitness tips','/blog/fitness',260,55,21.15,8.90),
('2023-03-14','travel deals','/blog/travel',330,75,22.73,5.80),
('2023-03-15','web design','/services/design',370,90,24.32,4.20),
('2023-03-16','buy shoes','/home',280,45,16.07,7.20),
('2023-03-17','cheap laptops','/products',390,95,24.36,4.00),
('2023-03-18','digital marketing','/services/marketing',300,70,23.33,7.50),
('2023-03-19','seo services','/blog/seo',340,60,17.65,9.00),
('2023-03-20','best smartphones','/products/smartphones',500,130,26.00,2.80),
('2023-03-21','python tutorial','/blog/python',270,68,25.19,5.50),
('2023-03-22','learn sql','/blog/python',290,75,25.86,6.80),
('2023-03-23','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-03-24','travel deals','/blog/travel',350,80,22.86,7.10),
('2023-03-25','web design','/services/design',360,85,23.61,4.00);


INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-03-26','buy shoes','/home',300,55,18.33,6.50),
('2023-03-27','cheap laptops','/products',410,90,21.95,4.80),
('2023-03-28','digital marketing','/services/marketing',280,60,21.43,8.20),
('2023-03-29','seo services','/blog/seo',370,75,20.27,7.50),
('2023-03-30','best smartphones','/products/smartphones',450,120,26.67,3.00),
('2023-03-31','python tutorial','/blog/python',260,65,25.00,5.20),
('2023-04-01','learn sql','/blog/python',280,72,25.71,6.90),
('2023-04-02','fitness tips','/blog/fitness',300,66,22.00,7.80),
('2023-04-03','travel deals','/blog/travel',340,78,22.94,5.70),
('2023-04-04','web design','/services/design',390,95,24.36,4.10),
('2023-04-05','buy shoes','/home',310,52,16.77,6.10),
('2023-04-06','cheap laptops','/products',420,98,23.33,4.20),
('2023-04-07','digital marketing','/services/marketing',310,70,22.58,7.60),
('2023-04-08','seo services','/blog/seo',280,55,19.64,8.90),
('2023-04-09','best smartphones','/products/smartphones',500,135,27.00,2.50),
('2023-04-10','python tutorial','/blog/python',270,68,25.19,5.30),
('2023-04-11','learn sql','/blog/python',290,75,25.86,6.70),
('2023-04-12','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-04-13','travel deals','/blog/travel',350,80,22.86,7.20),
('2023-04-14','web design','/services/design',360,85,23.61,4.00);


INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-04-15','buy shoes','/home',320,50,15.63,6.20),
('2023-04-16','cheap laptops','/products',400,85,21.25,4.50),
('2023-04-17','digital marketing','/services/marketing',270,60,22.22,8.80),
('2023-04-18','seo services','/blog/seo',360,72,20.00,7.20),
('2023-04-19','best smartphones','/products/smartphones',480,125,26.04,3.10),
('2023-04-20','python tutorial','/blog/python',290,70,24.14,5.00),
('2023-04-21','learn sql','/blog/python',310,80,25.81,6.50),
('2023-04-22','fitness tips','/blog/fitness',260,55,21.15,8.90),
('2023-04-23','travel deals','/blog/travel',330,75,22.73,5.80),
('2023-04-24','web design','/services/design',370,90,24.32,4.20),
('2023-04-25','buy shoes','/home',280,45,16.07,7.20),
('2023-04-26','cheap laptops','/products',390,95,24.36,4.00),
('2023-04-27','digital marketing','/services/marketing',300,70,23.33,7.50),
('2023-04-28','seo services','/blog/seo',340,60,17.65,9.00),
('2023-04-29','best smartphones','/products/smartphones',500,130,26.00,2.80),
('2023-04-30','python tutorial','/blog/python',270,68,25.19,5.50),
('2023-05-01','learn sql','/blog/python',290,75,25.86,6.80),
('2023-05-02','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-05-03','travel deals','/blog/travel',350,80,22.86,7.10),
('2023-05-04','web design','/services/design',360,85,23.61,4.00);


INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-05-05','buy shoes','/home',300,55,18.33,6.50),
('2023-05-06','cheap laptops','/products',410,90,21.95,4.80),
('2023-05-07','digital marketing','/services/marketing',280,60,21.43,8.20),
('2023-05-08','seo services','/blog/seo',370,75,20.27,7.50),
('2023-05-09','best smartphones','/products/smartphones',450,120,26.67,3.00),
('2023-05-10','python tutorial','/blog/python',260,65,25.00,5.20),
('2023-05-11','learn sql','/blog/python',280,72,25.71,6.90),
('2023-05-12','fitness tips','/blog/fitness',300,66,22.00,7.80),
('2023-05-13','travel deals','/blog/travel',340,78,22.94,5.70),
('2023-05-14','web design','/services/design',390,95,24.36,4.10),
('2023-05-15','buy shoes','/home',310,52,16.77,6.10),
('2023-05-16','cheap laptops','/products',420,98,23.33,4.20),
('2023-05-17','digital marketing','/services/marketing',310,70,22.58,7.60),
('2023-05-18','seo services','/blog/seo',280,55,19.64,8.90),
('2023-05-19','best smartphones','/products/smartphones',500,135,27.00,2.50),
('2023-05-20','python tutorial','/blog/python',270,68,25.19,5.30),
('2023-05-21','learn sql','/blog/python',290,75,25.86,6.70),
('2023-05-22','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-05-23','travel deals','/blog/travel',350,80,22.86,7.20),
('2023-05-24','web design','/services/design',360,85,23.61,4.00);

INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-05-25','buy shoes','/home',320,50,15.63,6.20),
('2023-05-26','cheap laptops','/products',400,85,21.25,4.50),
('2023-05-27','digital marketing','/services/marketing',270,60,22.22,8.80),
('2023-05-28','seo services','/blog/seo',360,72,20.00,7.20),
('2023-05-29','best smartphones','/products/smartphones',480,125,26.04,3.10),
('2023-05-30','python tutorial','/blog/python',290,70,24.14,5.00),
('2023-05-31','learn sql','/blog/python',310,80,25.81,6.50),
('2023-06-01','fitness tips','/blog/fitness',260,55,21.15,8.90),
('2023-06-02','travel deals','/blog/travel',330,75,22.73,5.80),
('2023-06-03','web design','/services/design',370,90,24.32,4.20),
('2023-06-04','buy shoes','/home',280,45,16.07,7.20),
('2023-06-05','cheap laptops','/products',390,95,24.36,4.00),
('2023-06-06','digital marketing','/services/marketing',300,70,23.33,7.50),
('2023-06-07','seo services','/blog/seo',340,60,17.65,9.00),
('2023-06-08','best smartphones','/products/smartphones',500,130,26.00,2.80),
('2023-06-09','python tutorial','/blog/python',270,68,25.19,5.50),
('2023-06-10','learn sql','/blog/python',290,75,25.86,6.80),
('2023-06-11','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-06-12','travel deals','/blog/travel',350,80,22.86,7.10),
('2023-06-13','web design','/services/design',360,85,23.61,4.00);



INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-06-14','buy shoes','/home',300,55,18.33,6.50),
('2023-06-15','cheap laptops','/products',410,90,21.95,4.80),
('2023-06-16','digital marketing','/services/marketing',280,60,21.43,8.20),
('2023-06-17','seo services','/blog/seo',370,75,20.27,7.50),
('2023-06-18','best smartphones','/products/smartphones',450,120,26.67,3.00),
('2023-06-19','python tutorial','/blog/python',260,65,25.00,5.20),
('2023-06-20','learn sql','/blog/python',280,72,25.71,6.90),
('2023-06-21','fitness tips','/blog/fitness',300,66,22.00,7.80),
('2023-06-22','travel deals','/blog/travel',340,78,22.94,5.70),
('2023-06-23','web design','/services/design',390,95,24.36,4.10),
('2023-06-24','buy shoes','/home',310,52,16.77,6.10),
('2023-06-25','cheap laptops','/products',420,98,23.33,4.20),
('2023-06-26','digital marketing','/services/marketing',310,70,22.58,7.60),
('2023-06-27','seo services','/blog/seo',280,55,19.64,8.90),
('2023-06-28','best smartphones','/products/smartphones',500,135,27.00,2.50),
('2023-06-29','python tutorial','/blog/python',270,68,25.19,5.30),
('2023-06-30','learn sql','/blog/python',290,75,25.86,6.70),
('2023-07-01','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-07-02','travel deals','/blog/travel',350,80,22.86,7.20),
('2023-07-03','web design','/services/design',360,85,23.61,4.00);


INSERT INTO SEO_Traffic (Date, Keyword, Page, Impressions, Clicks, CTR, Position) VALUES
('2023-07-04','buy shoes','/home',320,50,15.63,6.20),
('2023-07-05','cheap laptops','/products',400,85,21.25,4.50),
('2023-07-06','digital marketing','/services/marketing',270,60,22.22,8.80),
('2023-07-07','seo services','/blog/seo',360,72,20.00,7.20),
('2023-07-08','best smartphones','/products/smartphones',480,125,26.04,3.10),
('2023-07-09','python tutorial','/blog/python',290,70,24.14,5.00),
('2023-07-10','learn sql','/blog/python',310,80,25.81,6.50),
('2023-07-11','fitness tips','/blog/fitness',260,55,21.15,8.90),
('2023-07-12','travel deals','/blog/travel',330,75,22.73,5.80),
('2023-07-13','web design','/services/design',370,90,24.32,4.20),
('2023-07-14','buy shoes','/home',280,45,16.07,7.20),
('2023-07-15','cheap laptops','/products',390,95,24.36,4.00),
('2023-07-16','digital marketing','/services/marketing',300,70,23.33,7.50),
('2023-07-17','seo services','/blog/seo',340,60,17.65,9.00),
('2023-07-18','best smartphones','/products/smartphones',500,130,26.00,2.80),
('2023-07-19','python tutorial','/blog/python',270,68,25.19,5.50),
('2023-07-20','learn sql','/blog/python',290,75,25.86,6.80),
('2023-07-21','fitness tips','/blog/fitness',310,65,20.97,8.10),
('2023-07-22','travel deals','/blog/travel',350,80,22.86,7.10),
('2023-07-23','web design','/services/design',360,85,23.61,4.00);


select * from SEO_Traffic

---Top keywords by clicks

SELECT Keyword, SUM(Clicks) AS Total_Clicks FROM SEO_Traffic GROUP BY Keyword ORDER BY Total_Clicks DESC;

---Pages with highest CTR

Select page, Avg(CTR) as Avg_CTR from SEO_Traffic group by page order by Avg_CTR desc;

---Traffic Trends Month-by-Month

Select FORMAT(Date, 'yyyy-MM') as Month, SUM(impressions) as Total_Impressions, SUM(Clicks) as Total_clicks, 
	CAST(SUM(clicks) * 100.0 / SUM(impressions) AS DECIMAL(5,2)) AS CTR_Percentage FROM SEO_Traffic
		GROUP BY FORMAT(Date, 'yyyy-MM') ORDER BY Month;

	---Find top 5 keywords with the highest impressions

Select keyword, SUM(impressions) as Total_impressions from SEO_Traffic group by keyword order by Total_impressions desc;

----Find pages with CTR greater than 10%
select page, AVG(CTR) As Avg_CTR from SEO_Traffic group by page having AVG(CTR)>10 order by Avg_CTR desc;

----Find top 3 pages by total clicks each month (uses window functions)

Select Month, page, Total_Clicks From (
	Select FORMAT(date, ('yyyy-MM')) as Month, Page, 
		SUM(clicks) as Total_Clicks, 
		Rank() Over(
					PARTITION BY FORMAT(Date, 'yyyy-MM') ORDER BY SUM(Clicks) DESC) AS Ranks 
	from SEO_Traffic 
	group by FORMAT(Date, 'yyyy-MM'), Page) t 
WHERE Ranks <= 3 
ORDER BY Month, Total_Clicks DESC;

---Find keyword performance trend (month by month)
Select 
	Keyword,  FORMAT(Date, 'yyyy-MM') AS Month, 
	SUM(clicks) as Total_Clicks,
	SUM(impressions) as Total_impressions,
	CAST(SUM(Clicks) * 100.0 / NULLIF(SUM(Impressions),0) AS DECIMAL(5,2)) AS CTR_precentage
from SEO_Traffic
group by keyword, FORMAT(Date, 'yyyy-MM')
Order by month, keyword;


---Find keywords with more than 500 total clicks but CTR < 20%
SELECT Keyword,
       SUM(Clicks) AS Total_Clicks,
       CAST(SUM(Clicks) * 100.0 / SUM(Impressions) AS DECIMAL(5,2)) AS CTR_Percentage
FROM SEO_Traffic
GROUP BY Keyword
HAVING SUM(Clicks) > 500 AND (SUM(Clicks) * 100.0 / SUM(Impressions)) < 20
ORDER BY Total_Clicks DESC;

---Compare performance of pages (Impressions vs Clicks ratio)
Select page, 
	SUM(clicks) as Total_Clicks,
	SUM(impressions) as Total_impressions, 
	CAST(SUM(Clicks) * 1.0 / NULLIF(SUM(Impressions),0) AS DECIMAL(5,2)) AS Clicks_Per_Impression
FROM SEO_Traffic
GROUP BY Page
Order by Clicks_Per_Impression;

---Top 5 Pages by CTR
Select page, 
	CAST(SUM(clicks) * 100.0/ SUM(impressions) As Decimal(5,2)) As Total_CTR
FROM SEO_Traffic
Group by Page
Order by Total_CTR desc;

---Monthly Click-Through Rate Trend
Select 
	FORMAT(date, 'yyyy-MM') as Month , 
	CAST(SUM(clicks) * 100.0/ SUM(impressions) As Decimal(5,2)) As Total_CTR
FROM SEO_Traffic
Group by FORMAT(date, 'yyyy-MM')
Order by FORMAT(date, 'yyyy-MM') desc;


select * from SEO_Traffic
---Compare Branded vs Non-Branded Keywords
Select
	CASE
		When keyword like '%brandname%' then 'Branded'
		Else 'Non-Branded'
	End As Keyword_Type,
	SUM(clicks) As Total_clicks,
	SUM(Impressions) as Total_impressions,
	Cast(SUM(clicks) * 100.0 / SUM(Impressions) As Decimal (5,2)) As CTR_percantage
From SEO_Traffic
Group by 
	CASE
		When keyword like '%brandname%' then 'Branded'
		Else 'Non-Branded'
	End;

--Pages with Above-Average CTR
SELECT 
    Page, 
    CAST(SUM(Clicks) * 100.0 / SUM(Impressions) AS DECIMAL(5,2)) AS CTR_Percentage 
FROM SEO_Traffic 
GROUP BY Page 
Having
	CAST(SUM(Clicks) * 100.0 / SUM(Impressions) AS DECIMAL(5,2)) > (
		SELECT CAST(SUM(Clicks) * 100.0 / SUM(Impressions) AS DECIMAL(5,2)) 
		FROM SEO_Traffic
		)
ORDER BY CTR_Percentage DESC;
	
---Find the Top 5 Keywords by Total Clicks
Select Keyword, 
		SUM(clicks) As Total_clicks
From SEO_Traffic
Group by Keyword
Order by Total_clicks Desc;

--Average Position by Page
Select Page, 
	AVG(Position) As Avg_Position
From SEO_Traffic
Group by Page
Order by Avg_Position Asc;

----Keywords with CTR Above Overall Average
Select Keyword,
	Avg(CTR) As Avg_CTR
From SEO_Traffic
Group by Keyword
HAVING Avg(CTR) > (Select Avg(CTR) FROM  SEO_Traffic);

---Daily Trend of Click-Through Rate (CTR)
SELECT * FROM SEO_Traffic
SELECT DATE, 
	CAST(SUM(CLICKS) * 100.0 / NULLIF(SUM(Impressions),0) AS DECIMAL(5,2)) AS CTR_PERCENTAGE
FROM SEO_Traffic
GROUP BY DATE
ORDER BY DATE;

---Keywords with High Impressions but Low CTR (Missed Opportunities)
SELECT KEYWORD, 
	SUM(Impressions) AS TOTAL_Impressions,
	CAST(SUM(CLICKS) * 100.0 / NULLIF(SUM(Impressions),0) AS DECIMAL(5,2)) AS CTR_PERCENTAGE
FROM SEO_Traffic
GROUP BY KEYWORD
HAVING 
	SUM(Impressions) >1000 AND 
	(SUM(CLICKS) * 100.0 / SUM(Impressions)) <25
ORDER BY Total_Impressions DESC;

--Find Pages with Highest CTR
SELECT PAGE,
	CAST(SUM(CLICKS) * 100.0 / NULLIF(SUM(IMPRESSIONS), 0) AS DECIMAL(5,2) ) AS CTR_PERCENTAGE
FROM SEO_Traffic
GROUP BY PAGE
ORDER BY CTR_PERCENTAGE DESC;

---Keywords That Improved Over Time (Compare First vs Last Position)
SELECT KEYWORD, 
	MIN(POSITION) AS BEST_POSITION,
	MAX(POSITION) AS WORST_POSITION
FROM SEO_Traffic
GROUP BY KEYWORD
HAVING MIN(POSITION) < MAX(POSITION); 

---Cumulative Clicks Over Time
SELECT 
    Date,
    SUM(Clicks) OVER (ORDER BY Date) AS Cumulative_Clicks
FROM SEO_Traffic
ORDER BY Date;

---Cumulative CTR (running total)
SELECT DATE,
 SUM(CLICKS) OVER (ORDER BY DATE) * 100.0 / SUM(IMPRESSIONS) OVER (ORDER BY DATE) AS Cumulative_CTR
 FROM SEO_Traffic
 ORDER BY Date;

 ---Top 5 keywords with the best CTR but low impressions (hidden gems)
 SELECT KEYWORD, 
	SUM(IMPRESSIONS) AS TOTAL_IMPRESSIONS,
	CAST(SUM(CLICKS) * 100.0 / NULLIF(SUM(IMPRESSIONS),0) AS DECIMAL(5,2)) AS CTR_PERCENTAGE
FROM SEO_Traffic
GROUP BY KEYWORD
HAVING SUM(IMPRESSIONS) <6000
ORDER BY CTR_PERCENTAGE

---Calculate monthly growth in clicks
SELECT 
    FORMAT(Date, 'yyyy-MM') AS Month,
    SUM(Clicks) AS Total_Clicks,
    LAG(SUM(Clicks)) OVER (ORDER BY FORMAT(Date, 'yyyy-MM')) AS Prev_Month_Clicks,
    SUM(Clicks) - LAG(SUM(Clicks)) OVER (ORDER BY FORMAT(Date, 'yyyy-MM')) AS Growth_Clicks
FROM SEO_Traffic
GROUP BY FORMAT(Date, 'yyyy-MM')
ORDER BY Month;

----Find keywords where average position is better than 5 (high ranking keywords)
SELECT KEYWORD, 
	AVG(POSITION) AS AVG_POSTION
FROM SEO_Traffic
GROUP BY KEYWORD
HAVING AVG(POSITION) < 5
ORDER BY AVG_POSTION ASC;

select * FROM SEO_Traffic

---Running Total of Clicks Over Time (Window Function)
SELECT DATE, PAGE, CLICKS,
	SUM(CLICKS) OVER(PARTITION BY Page ORDER BY Date) AS RunningTotalClicks
FROM SEO_Traffic

---Rank Pages by Clicks Each Month
WITH MONTHLYTRAFFIC AS (
   SELECT FORMAT(DATE, 'yyyy-MM') AS MONTH, PAGE, SUM(CLICKS) AS TOTALCLICKS 
   FROM SEO_Traffic
   GROUP BY FORMAT(DATE, 'yyyy-MM'), PAGE
)
SELECT 
	MONTH, PAGE, TOTALCLICKS,
	RANK() OVER(PARTITION BY MONTH ORDER BY TOTALCLICKS DESC) AS PAGERANK
FROM MONTHLYTRAFFIC;







